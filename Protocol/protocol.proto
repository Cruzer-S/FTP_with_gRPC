syntax = "proto3";

import "google/protobuf/timestamp.proto";

//
service FTPService {
  // upload file to server
  rpc UploadFile(stream FileUploadStream) returns (FileMetaData);
}

enum UploadFileProgress {
  UPLOAD_PROGRESS_UNKNOWN = 0;
  UPLOAD_PROGRESS_PATH    = 1;
  UPLOAD_PROGRESS_CHUNK   = 2;
  UPLOAD_PROGRESS_HASH    = 3;
  UPLOAD_PROGRESS_DONE    = 4;
};

enum HashType {
  HASH_TYPE_UNKNOWN = 0;
  HASH_TYPE_SHA256  = 1;
  HASH_TYPE_SHA512  = 2;
};

message FileUploadStream {
  UploadFileProgress progress = 1;
  oneof data {
    string path  = 2; // absolute path
    bytes  chunk = 3; // variable chunk size (default: BUFSIZ)
    bytes  hash  = 4; // hash method/size followed by HashType
  }
  uint64   filesize = 5; // total chunk size (based on binary size)
  HashType hashtype = 6;
}

message FileMetaData {
  string                    path        = 1;
  uint64                    size        = 2;
  bytes                     hash        = 3;
  HashType                  hashtype    = 4;
  google.protobuf.Timestamp create_time = 5;
  google.protobuf.Timestamp modify_time = 6;
  google.protobuf.Timestamp access_time = 7;
}